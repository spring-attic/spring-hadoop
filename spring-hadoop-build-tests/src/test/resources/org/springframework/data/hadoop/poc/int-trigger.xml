<beans xmlns="https://www.springframework.org/schema/beans"
	xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance"
	xmlns:int="https://www.springframework.org/schema/integration"
	xmlns:file="https://www.springframework.org/schema/integration/file"
	xmlns:p="https://www.springframework.org/schema/p"
	xsi:schemaLocation="https://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
      	https://www.springframework.org/schema/integration https://www.springframework.org/schema/integration/spring-integration.xsd
      	https://www.springframework.org/schema/integration/file https://www.springframework.org/schema/integration/file/spring-integration-file.xsd">

	<!--  watch for input files to act as a trigger -->
	
	<file:inbound-channel-adapter id="input-logs" directory="file:bin/${input.directory}" filename-pattern="*ready" channel="in">
		<int:poller fixed-delay="1000"/>
	</file:inbound-channel-adapter>
	
	<int:channel id="in"/>
	
	<!-- once detected, trigger  -->
	<int:service-activator input-channel="in" output-channel="done" expression="@jobLauncher.run(@batch, new org.springframework.batch.core.JobParameters())"/>

	<int:logging-channel-adapter id="done"/>
	
	<int:resource-inbound-channel-adapter id="hdfs-trigger" channel="logger" pattern-resolver="hadoopResourceLoader" pattern="**/*">
		<int:poller fixed-rate="200"/>
	</int:resource-inbound-channel-adapter>

	<int:logging-channel-adapter id="logger" expression="T(java.util.Arrays).toString(payload)" level="WARN"/>	
</beans>