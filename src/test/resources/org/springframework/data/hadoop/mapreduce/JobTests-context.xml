<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:hdp="http://www.springframework.org/schema/hadoop"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/hadoop http://www.springframework.org/schema/hadoop/spring-hadoop.xsd">

	<import resource="../hadoop-ctx.xml"/>

	<hdp:script id="script" language="javascript">
	if (fsh.test("/ide-test/input/word")) { fsh.rmr("/ide-test/input/word") }
	if (fsh.test("/ide-test/runner/output")) { fsh.rmr("/ide-test/runner/output") }
	if (fsh.test("/ide-test/runner/output-2")) { fsh.rmr("/ide-test/runner/output-2") }
	
	fsh.put("src/test/resources/input/word", "/ide-test/input/word")			
	</hdp:script>

	<bean id="runner" class="org.springframework.data.hadoop.mapreduce.JobRunner" depends-on="script" p:jobs-ref="ns-job"/>
	
	<bean id="no-wait" class="org.springframework.data.hadoop.mapreduce.JobRunner" depends-on="script">
		<property name="jobs">
			<list>
				<ref local="ns-job"/>
				
				<hdp:job id="nested-job" 
	   	input-path="/ide-test/input/word/" output-path="/ide-test/runner/output-2/"
		mapper="org.apache.hadoop.examples.WordCount.TokenizerMapper"
		reducer="org.apache.hadoop.examples.WordCount.IntSumReducer"
		configuration-ref="hadoop-configuration"
		validate-paths="false"/>
				
			</list>
		</property>
	</bean>
	 
	<hdp:job id="ns-job" 
	   	input-path="/ide-test/input/word/" output-path="/ide-test/runner/output/"
		mapper="org.apache.hadoop.examples.WordCount.TokenizerMapper"
		reducer="org.apache.hadoop.examples.WordCount.IntSumReducer"
		configuration-ref="hadoop-configuration"
		validate-paths="false"/>

</beans>
